<template>
    <div>
        <heading :level="1" class="mb-3">Log Files</heading>

        <div class="card">
            <div v-if="directories.length > 0" class="flex flex-wrap flex-col">
                <div v-for="(directory, index) in directories" class="p-3 files-card" :key="index">
                    <router-link
                        :to="{ name: 'bugster-log-files', query: {'directory_path': directory.path} }"
                        class="flex justify-between items-center overflow-hidden rounded-lg border border-50 p-4 hover:shadow-md cursor-pointer no-underline text-90"
                        active-class=""
                        exact-active-class="">
                        <div>
                            <svg class="files-card-icon mr-1" enable-background="new 0 0 347.479 347.479" version="1.1"
                                 viewBox="0 0 347.48 347.48"
                                 xml:space="preserve" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="m292.25 79.766h-188.61v-8.544c0-5.974-4.888-10.862-10.862-10.862h-62.368c-5.975 0-10.862 4.888-10.862 10.862v8.544h-3.258c-8.962 0-16.294 7.332-16.294 16.293v174.77c0 8.961 7.332 16.293 16.293 16.293h275.96c8.961 0 16.293-7.332 16.293-16.293v-174.77c1e-3 -8.961-7.331-16.293-16.293-16.293z"
                                    fill="#3c4b5f"/>
                                <rect x="23.243" y="95.385" width="262.06" height="176.11" fill="#3c4b5f"/>
                                <path
                                    d="m312.43 271.29c-2.135 8.704-11.213 15.825-20.175 15.825h-275.96c-8.961 0-14.547-7.121-12.412-15.825l34.598-141.05c2.135-8.704 11.213-15.825 20.175-15.825h275.96c8.961 0 14.547 7.121 12.412 15.825l-34.598 141.05z"
                                    fill="#3c4b5f"/>
                            </svg>
                            {{ directory.name }}
                        </div>
                        <div>
                            <svg class="files-card-icon" version="1.1" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <g fill="none" fill-rule="evenodd">
                                    <g fill="#3c4b5f" fill-rule="nonzero">
                                        <path
                                            d="m21 4c0.51284 0 0.93551 0.38604 0.99327 0.88338l0.0067277 0.11662v6.5c0 1.8686-1.4643 3.3951-3.308 3.4948l-0.19204 0.0051789h-13.085l3.2921 3.2929c0.36048 0.36048 0.38821 0.92772 0.083189 1.32l-0.083189 0.094207c-0.36048 0.36048-0.92772 0.38821-1.32 0.083189l-0.094207-0.083189-5-5c-0.035394-0.035394-0.06758-0.072781-0.096559-0.1118l-0.071663-0.11124-0.053446-0.11273-0.03538-0.10534-0.024827-0.11753-0.0070403-0.058665-0.0039775-0.089802 0.0027879-0.075238 0.017452-0.12549 0.029498-0.11142 0.043935-0.11108 0.052322-0.097487 0.063709-0.092191 0.083189-0.094207 5-5c0.39052-0.39052 1.0237-0.39052 1.4142 0 0.36048 0.36048 0.38821 0.92772 0.083189 1.32l-0.083189 0.094207-3.2921 3.2929h13.085c0.7797 0 1.4204-0.59489 1.4931-1.3555l0.0068666-0.14446v-6.5c0-0.55228 0.44772-1 1-1z"/>
                                    </g>
                                </g>
                            </svg>
                        </div>
                    </router-link>
                </div>
            </div>

            <div v-if="files.length > 0" class="flex flex-wrap flex-col">
                <div v-for="(file, index) in files" class="p-3 files-card" :key="index">
                    <a :href="file.download_link"
                       class="flex justify-between items-center overflow-hidden rounded-lg border border-50 p-4 hover:shadow-md cursor-pointer no-underline text-90"
                       title="Download Log" download>
                        <div>
                            {{ file.name }} <br>
                            Size: {{ file.size }}MB
                        </div>
                        <div>
                            <span class="d-inline-block mr-2" title="Rename Log">
                                <span v-on:click.prevent="renameLog(file.path)">
                                    <svg class="files-card-icon" xmlns="http://www.w3.org/2000/svg" fill="#3c4b5f"
                                         viewBox="138.07 152.08 760.6 732.42">
                                        <path
                                            d="M213.6 153.6c-33.9 7.3-61.4 33.1-72.3 68l-2.8 8.9-.3 285c-.3 315.7-.7 291.6 6.3 307.9 5.7 13.1 12.4 23.4 21.5 32.7 12.8 13.1 25.7 20.6 44.6 26.1l7.9 2.3h260c246.8 0 260.4-.1 267.4-1.8 18.8-4.5 34.6-13.2 47.6-26.1 12.7-12.6 19.5-24 25.9-43.6 2-6.4 2.1-7.7 2.4-113.5.1-58.9 0-108-.3-109.2-.6-2.5-4.5-4-6.8-2.6-.7.4-10.2 10.1-21 21.5L774 629.9v29.3c-.2 83-1.1 133.3-2.6 139.2-3.2 12.8-13.7 26.2-25.2 32-11.8 6 6.2 5.6-266.2 5.6-273.1 0-256 .3-267.4-5.8-11.4-6.1-22.9-21.6-25.5-34.4-.8-3.8-1.1-85-.9-280.3l.3-275 2.6-6.7c6.9-17.8 20.4-29.6 37.4-32.7 4.1-.8 54.1-1.1 163.2-1.1H547v78.2c0 86.1 0 85.8 6.1 98.5 4.3 9 13.2 17.9 22.2 22.2 11.9 5.7 15.7 6.1 62.6 6.1h42.3l7.5-7.3c4.2-3.9 19.9-19.9 34.9-35.4 24.3-25 27.4-28.6 27.4-31.4 0-2.9-7.5-10.7-82.2-85.8-45.3-45.4-84.4-84.4-87-86.7-2.6-2.4-6.4-4.8-8.5-5.3-2.6-.8-59.2-1.1-177.8-1-149.4.1-175 .3-180.9 1.5zM653.5 299l55 55H597v-55c0-30.3.3-55 .8-55 .4 0 25.5 24.7 55.7 55z"/>
                                        <path
                                            d="M290.3 240c-12.3 4-22.9 14.7-27.4 27.7-2.9 8.5-3.4 16.8-1.5 24.2 4.8 18.8 18.6 31.4 37.2 34 24.4 3.5 46.1-12.3 50.4-36.7 3.3-18.4-7.2-38.2-24.8-46.9-7-3.5-8.2-3.8-17.6-4-7.9-.2-11.4.1-16.3 1.7zM814 340.1c-3.6.3-9.6 1.6-13.3 2.8-12.2 4.1-19.3 9.9-43.2 35.2-12.1 12.9-41.3 43.6-65 68.4-23.6 24.8-50.9 53.4-60.5 63.5-55.3 58.5-112.7 118-130.1 135-9.8 9.5-12.3 12.6-14.7 18-1.6 3.6-12.5 35.3-24.2 70.5-18.7 56.5-21.2 64.5-20.7 68.8.5 5.4 2.8 9.1 7.8 12.5 6.9 4.8 9.3 4.1 70.9-21 62.2-25.3 73.3-30 79.9-33.6 6.6-3.7 17-14.7 21-22.2 2.6-4.8 7.7-10.8 19.5-23 8.9-9.1 26-26.8 38.1-39.5 37.7-39.4 71.7-74.7 104.9-109 48.7-50.2 57.6-59.3 78.7-81 19.3-19.9 24.8-26.8 29.4-36.8 8.8-19.1 8.1-42.9-1.6-62.7-3.7-7.4-5.8-10.1-16.8-21-6.9-6.9-15.1-14-18.3-15.8-12-7.1-27.3-10.4-41.8-9.1zm10.4 40.7c6 2.7 33.2 28.2 35.3 33 2 4.8 2.7 13.9 1.5 20.3-1.8 9.3-4.9 14.8-13.5 23.2l-8 7.9-25.6-25.4c-14-13.9-28.8-28.6-32.9-32.7l-7.3-7.4 6.8-6.9c7.8-8 13.5-12.2 18.4-13.7 5.7-1.7 19.7-.8 25.3 1.7zM512.9 690.2c3.6 3.4 18.3 17.8 32.7 31.9l26.1 25.7-6.6 2.5c-3.6 1.4-16 6.4-27.4 11.1-11.4 4.7-21.2 8.6-21.7 8.6s-1.4-1.8-2-3.9c-2.7-10.2-12.4-19.1-23.1-21.3-4.8-1-5.8-1.5-5.3-2.8.4-.8 5-14.2 10.3-29.7 5.3-15.6 9.8-28.3 10-28.3.2 0 3.4 2.8 7 6.2zM276.7 346.1c-11.3 2.7-19 14.5-17.3 26.4 1 6.5 6.1 13.4 12.1 16.5l4.9 2.5 96.1.3c68 .2 97.5 0 101.2-.8 7.2-1.6 12.9-6 15.9-12.3 5.3-11.4 1.3-24.1-9.5-30.5l-4.6-2.7-97.5-.2c-55.2 0-99.1.3-101.3.8zM272.4 428.9c-7.4 3.4-13.4 12.8-13.4 21.2 0 4.4 2.5 10.1 6.2 14.4 7.1 8.1-.7 7.6 116.4 7.3l104-.3 4.2-2.7c7.9-5.3 12.1-17.4 9.2-26.4-1.8-5.2-9.3-13.1-13.9-14.4-2.3-.6-40.3-1-106.1-1-97.4 0-102.7.1-106.6 1.9zM527.6 429.5c-10 3.5-16.4 16-13.6 26.3 1.3 5.1 6.9 11.6 12.1 14.3 5.1 2.5 13.7 2.5 18.8-.1 7.5-3.8 12.1-11.4 12.1-20.1 0-15.1-15-25.6-29.4-20.4zM585.9 430.8c-13.6 7.1-16 25.9-4.7 35.7 5.3 4.4 9.6 5.8 16.8 5.3 10.8-.8 18.1-8.3 18.8-19.3.5-8.1-1-12.5-6.1-17.8-7-7.2-15.9-8.6-24.8-3.9zM271.9 510c-11.6 6.1-15.9 19.3-9.9 30.9 2.4 4.8 7.9 9.4 12.9 11 2.8.8 39.3 1.1 133.7 1.1h129.9l5-2.4c8.8-4 13.5-11.4 13.5-21.1 0-8.6-5.9-17.6-13.3-20.4-2-.8-44.3-1.1-135.5-1.1-127.9.1-132.8.2-136.3 2zM284.8 596.9c-7.4 2.4-11.5 5-17 10.9-5.7 6.1-7.4 9.3-9.4 17.9-4.9 20.8 7 41.9 26.6 47.4 3.5 1 21.9 1.2 80.5 1 71-.2 76.2-.3 78.5-2 1.8-1.3 3.4-4.6 6.1-12.7 6.4-19.8 9.1-23.8 28.1-42.5 9.2-9.2 16.8-17.4 16.8-18.3 0-.9-1.2-2.1-2.6-2.6-1.6-.6-39.7-1-102.2-.9-93.4 0-100.1.1-105.4 1.8zM280.4 707.1c-6.7 2.6-13.8 9.7-17.8 17.9-2.7 5.7-3.1 7.5-3.1 15 0 7.2.4 9.3 2.7 14.1 3.6 7.2 9.8 13.5 16.8 16.8l5.5 2.6 60 .3c42.3.2 60.7-.1 62.6-.8 1.5-.7 3.6-2.1 4.7-3.3 2.2-2.6 18.3-51.6 18.5-56.6.1-2.5-.6-4-2.7-5.7l-2.7-2.4-69.7.1c-66.9 0-69.9.1-74.8 2z"/>
                                    </svg>
                                </span>
                            </span>

                            <span class="d-inline-block">
                                <svg class="files-card-icon" viewBox="0 0 330 330" xml:space="preserve"
                                     xmlns="http://www.w3.org/2000/svg" fill="#3c4b5f">
                                <path
                                    d="m154.39 255.6c0.351 0.351 0.719 0.683 1.103 0.998 0.169 0.138 0.347 0.258 0.52 0.388 0.218 0.164 0.432 0.333 0.659 0.484 0.212 0.142 0.432 0.265 0.649 0.395 0.202 0.121 0.4 0.248 0.608 0.359 0.223 0.12 0.453 0.221 0.681 0.328 0.215 0.102 0.427 0.21 0.648 0.301 0.223 0.092 0.45 0.167 0.676 0.247 0.236 0.085 0.468 0.175 0.709 0.248 0.226 0.068 0.456 0.119 0.684 0.176 0.246 0.062 0.489 0.131 0.739 0.181 0.263 0.052 0.529 0.083 0.794 0.121 0.219 0.031 0.435 0.073 0.658 0.095 0.492 0.048 0.986 0.075 1.48 0.075s0.988-0.026 1.479-0.075c0.226-0.022 0.444-0.064 0.667-0.096 0.262-0.037 0.524-0.068 0.784-0.12 0.255-0.05 0.504-0.121 0.754-0.184 0.223-0.057 0.448-0.105 0.669-0.172 0.246-0.075 0.483-0.167 0.724-0.253 0.221-0.08 0.444-0.152 0.662-0.242 0.225-0.093 0.44-0.202 0.659-0.306 0.225-0.106 0.452-0.206 0.672-0.324 0.21-0.112 0.408-0.239 0.611-0.361 0.217-0.13 0.437-0.252 0.648-0.394 0.222-0.148 0.431-0.314 0.644-0.473 0.179-0.134 0.362-0.258 0.536-0.4 0.365-0.3 0.714-0.617 1.049-0.949 0.016-0.016 0.034-0.028 0.049-0.044l70.002-69.998c5.858-5.858 5.858-15.355 0-21.213-5.857-5.857-15.355-5.858-21.213-1e-3l-44.396 44.393v-183.79c0-8.284-6.716-15-15-15s-15 6.716-15 15v183.78l-44.392-44.391c-5.857-5.858-15.355-5.858-21.213 0s-5.858 15.355 0 21.213l69.997 69.995z"/>
                                <path
                                    d="m315 160c-8.284 0-15 6.716-15 15v115h-270v-115c0-8.284-6.716-15-15-15s-15 6.716-15 15v130c0 8.284 6.716 15 15 15h300c8.284 0 15-6.716 15-15v-130c0-8.284-6.716-15-15-15z"/>
                            </svg>
                            </span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import axios from "axios";

export default {
    metaInfo() {
        return {
            title: 'Log Files',
        }
    },
    data() {
        return {
            directories: [],
            files: []
        }
    },
    methods: {
        getFiles(path) {

            let route = '/nova-vendor/vlinde/bugster/log-files';

            if (path) {
                route += `/?path=${path}`;
            }

            axios.get(route)
                .then(({data}) => {
                    this.directories = data.directories
                    this.files = data.files
                })
        },
        renameLog(filePath) {

            let self = this;

            axios.post(
                '/nova-vendor/vlinde/bugster/log-files/rename',
                {
                    file_path: filePath
                })
                .then(() => {
                    let path = null;
                    if (self.$route.query.directory_path) {
                        path = self.$route.query.directory_path;
                    }

                    self.getFiles(path);
                })
                .catch(() => {
                    alert('Something went wrong.');
                })
        }
    },
    mounted() {
        let path = null;

        if (this.$route.query.directory_path) {
            path = this.$route.query.directory_path;
        }

        this.getFiles(path);
    },

    beforeRouteUpdate(to, from, next) {
        if (to.query.directory_path !== from.query.directory_path) {
            this.getFiles(to.query.directory_path);
            window.scrollTo(0, 0);
        }

        next();
    },
}
</script>

<style scoped>
.files-card {
    width: 100%;
}

.files-card-icon {
    width: 20px;
    vertical-align: middle;
}
</style>
